[dig](https://github.com/uber-go/dig)を使って DI を学ぶ。

```sh
go get 'go.uber.org/dig@v1'
```

## 概念など

### Provide, Constructor

Provide は、依存関係を DI コンテナに登録する処理のこと。

Constructor は、「依存関係を作成する関数」とあるが、シンプルに「何かを生成するもの」と思っておく。
Go でいうところの `NewXxx` とかの関数のこと。

dig の場合、Provide 関数にこの Constructor 関数を渡すことになる。

### Invoke

DI コンテナに登録された依存を使って、関数を実行する処理のこと。

dig の場合、Invoke 関数も関数を受けとる関数で、
受けとった関数をそれ以前に Provide 関数で登録した関数（依存を提供するもの、すなわち Constructor）を用いて、
実際に実行する。

### DI コンテナを使った依存解決の流れ

Provide で登録した関数は、Invoke 実行時に遅延評価される、ということっぽい。

## DI コンテナを使う嬉しさ

- 依存関係の解決を自動化できる
    - DAG にさえなっていれば、Provide の呼び出し順などに気をつかう必要はない
- コードの可読性が向上する
    - Provide 呼び出しイコール依存解決という認識が出来る
- テストがしやすくなる
    - 依存をモックに差しかえるのが簡単

「Provide で登録し、Invoke で実行する」という認識と「Invoke で無名関数を使う」というところを意識すると、
使い勝手が良く感じられる、かもしれない。
